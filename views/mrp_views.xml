<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <record model="ir.ui.view" id="mrp_production_tree_form_mod">
      <field name="name">x_gfp.mrp.production.form.mod</field>
      <field name="model">mrp.production</field>
      <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
      <field name="priority">99</field>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='move_raw_ids']/.." position="replace"/>
        <xpath expr="//field[@name='move_finished_ids']/.." position="after">
          <page string="Consumed Materials">
              <field name="move_raw_ids" options="{'reload_on_button': True}" context="{'default_location_id': location_src_id, 'default_location_dest_id': location_dest_id}">
                  <tree editable="bottom" delete="0" default_order="is_done desc,sequence" decoration-muted="is_done" decoration-warning="quantity_done&gt;product_uom_qty" decoration-success="quantity_done==product_uom_qty" decoration-danger="quantity_available &lt; product_uom_qty" create="0">
                      <field name="product_id" required="1"/>
                      <field name="product_uom" groups="product.group_uom"/>
                      <field name="has_tracking" invisible="1"/>
                      <field name="is_done" invisible="1"/>
                      <field name="sequence" invisible="1"/>
                      <field name="location_id" domain="[('id', 'child_of', parent.location_id)]" invisible="1"/>
                      <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                      <field name="state" invisible="1"/>
                      <field name="quantity_available" attrs="{'invisible': [('is_done', '=', True)]}"/>
                      <field name="product_uom_qty" readonly="1" attrs="{'required': [('product_id', '!=', False)]}" string="To Consume"/>
                      <field name="quantity_done" attrs="{'readonly': ['|', ('is_done', '=', True), ('has_tracking', 'in', ['lot','serial'])]}" string="Consumed"/>
                      <button name="split_move_lot" string="Register lots" type="object" icon="fa-list" attrs="{'invisible': [('has_tracking', 'not in', ['lot','serial'])]}"/>
                  </tree>
              </field>
          </page>
        </xpath>
      </field>
    </record>
    <record model="ir.ui.view" id="mrp_workorder_form_view_mod">
      <field name="name">x_gfp.mrp.production.work.order.form.mod</field>
      <field name="model">mrp.workorder</field>
      <field name="inherit_id" ref="mrp.mrp_production_workcenter_form_view_inherit"/>
      <field name="priority">99</field>
      <field name="arch" type="xml">
        <!--Removed buttons to just have done per workorder-->
        <xpath expr="//button[@name='button_finish']" position="replace"/>
        <xpath expr="//button[@name='button_start']" position="replace"/>
        <xpath expr="//button[@name='button_start']" position="replace"/>
        <xpath expr="//button[@name='button_start']" position="replace"/>
        <xpath expr="//button[@name='button_start']" position="replace"/>
        <xpath expr="//button[@name='button_pending']" position="replace"/>
        <xpath expr="//button[@name='record_production']" position="attributes">
          <attribute name="attrs">{'invisible': ['|',('is_produced', '=', True),('working_state', '=', 'blocked')]}</attribute>
        </xpath>

        <xpath expr="//field[@name='product_id']" position="before">
          <field name="sale_workorder_id"/>
          <field name="done_user" readonly="1" attrs="{'invisible':[('done_user','=',False)]}"/>
        </xpath>
        <!--Removed due to client's requestion, however, leaving for future addittion in case if they want it.
        <xpath expr="//button[@name='record_production']" position="attributes">
          <attribute name="name">%(action_mrp_entry_wizard)d</attribute>
          <attribute name="type">action</attribute>
        </xpath>-->
        <xpath expr="//field[@name='time_ids']//tree//field[@name='duration']" position="after">
          <field name="operators"/>
          <field name="man_hours" widget="float_time"/>
        </xpath>
        <xpath expr="//field[@name='time_ids']//form//field[@name='duration']" position="after">
          <field name="operators"/>
          <field name="man_hours" widget="float_time"/>
        </xpath>
        <xpath expr="//notebook/page" position="before">
          <page string="Special Instructions" attrs="{'invisible': [('special_instructions', '=', False)]}">
            <field name="special_instructions" widget="pdf_viewer"/>
          </page>
        </xpath>
        <xpath expr="//field[@name='product_id']" position="replace">
          <label for="product_id" string="To Produce"/>
          <div class="o_row">
              <field name="product_id"/>
              <field name="attribute_id" invisible="1"/>
              <button attrs="{'invisible':[('attribute_id','=',False)]}" string="Attributes" type="object" name="open_attribute_values"/>
          </div>
        </xpath>
      </field>
    </record>
    <record model="ir.ui.view" id="mrp_workorder_tree_view_mod">
      <field name="name">x_gfp.mrp.production.work.order.tree.mod</field>
      <field name="model">mrp.workorder</field>
      <field name="inherit_id" ref="mrp.mrp_production_workcenter_tree_view_inherit"/>
      <field name="priority">99</field>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='name']" position="after">
          <field name="sale_workorder_id" invisible="1"/>
        </xpath>
        <xpath expr="//field[@name='date_planned_start']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//field[@name='workcenter_id']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//field[@name='production_id']" position="attributes">
          <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//field[@name='product_id']" position="replace"/>
        <xpath expr="//field[@name='name']" position="replace"/>
        <xpath expr="//field[@name='date_planned_start']" position="before">
          <field name="product_id"/>
          <field name="attribute_id" invisible="1"/>
          <button attrs="{'invisible':[('attribute_id','=',False)]}" icon="fa fa-dot-circle-o" type="object" name="open_attribute_values"/>
        </xpath>
        <xpath expr="//field[@name='date_planned_start']" position="after">
          <field name="requested_date"/>
          <field name="commitment_date"/>
        </xpath>
        <xpath expr="//field[@name='state']" position="after">
          <field name="name"/>
          <field name="done_user"/>
        </xpath>
      </field>
    </record>
    <record model="ir.actions.act_window" id="mrp.action_work_orders">
      <field name="context">{'group_by':'sale_workorder_id'}</field>
    </record>
  </data>
</odoo>
